const fs = require('fs')
const path = require('path')

const packageRoot = process.cwd()
const packageJsonPath = path.join(packageRoot, 'package.json')
const outPath = path.join(packageRoot, 'src', 'lib', 'version.ts')

if (!fs.existsSync(packageJsonPath)) {
    console.error(`No package.json found at ${packageJsonPath}`)
    process.exit(1)
}

const pkg = JSON.parse(fs.readFileSync(packageJsonPath, 'utf8'))
const version = pkg.version ?? '0.0.0'

const contents = `// Generated by tools/scripts/write-frontend-version.cjs\nexport const FRONTEND_VERSION = '${version}'\n`

fs.mkdirSync(path.dirname(outPath), { recursive: true })
if (!fs.existsSync(outPath) || fs.readFileSync(outPath, 'utf8') !== contents) {
    fs.writeFileSync(outPath, contents, 'utf8')
}
